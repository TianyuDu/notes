\documentclass[11pt]{article}

\usepackage{spikey}
\usepackage{amssymb}
\usepackage[margin=1in]{geometry}

\usepackage{setspace}
\linespread{1.15}

\title{Lecture Notes \\ MATH205A: Real Analysis I (Autumn 2020) \\ @ Stanford University}

\author{Tianyu Du}

\begin{document}
	\maketitle
	\section{Measures}
	\subsection{Motivation}
	\textbf{Motivation of this course} is to define a notion of \emph{length} on subsets of $\R$ such that
	\begin{enumerate}
		\item $length([a,b]) = b - a$.
		\item (countable additivity) $length(\bigcup^\infty A_i) = \sum^\infty length(A_i)$ where $A_i$'s are disjoint.
		\item (translation invariance) for all $a \in \R$, $length(A + a) = length(A)$.
	\end{enumerate}
	\begin{fact} it is impossible to construct such length for all subsets of $\R$.
	\begin{proof}
		This proof shows it is impossible to construct a notion of length on $[0, 1]$ with desired properties.
		
		For $x, y \in [0, 1]$, define an equivalence relation as $x \sim y \iff x - y \in \Q$. By the axiom of choice, we may construct a set $A$ containing exactly one element from each equivalence class of $x \in [0, 1]$. Obviously, $A \subseteq [0, 1]$.
		
		For each $r \in [-1, 1] \cap \Q$, let $A_r := A + r$, and $A_r \subseteq [-1, 2]$.
		By translation invariance, $length(A_r) = length(A)$.
		Note that for any $y \in [0, 1]$, there exists some $x \in A$ such that $x \sim y$, therefore, $y \in A_{y-x} \subseteq \bigcup_r A_r$. Hence, $[0, 1] \subseteq \bigcup_r A_r$.
		
		If the notion of length satisfies countable additivity, $length(\bigcup_r A_r)$ is either zero or infinity, which leads to a contradiction.
	\end{proof}
	\end{fact}
	
	\textbf{Lebesgue's Resolution}: we only defines length for a subset of $\mc{P}(\R)$, which contains \emph{everything that may ever arrive in practice}, i.e., $\sigma$-algebras.
	
	\subsection{Algebras and \salg}
	
	\begin{definition}
		Let $X$ be a set, a collection $\mc{A}$ of subsets of $X$ is called an \textbf{algebra} if
		\begin{enumerate}
			\item $X \in \mc{A}$,
			\item $A \in \mc{A} \implies A^c \in \mc{A}$,
			\item $A, B \in \mc{A} \implies A \cup B \in \mc{A}$.
		\end{enumerate}
		Consequently: (1) $A, B \in \mc{A} \implies A \cap B \in \mc{A}$; (2) $A_1, \dots, A_n \in \mc{A} \implies \bigcup_i A_i, \bigcap_i A_i \in \mc{A}$ (easily shown by induction); (3) $\varnothing \in \mc{A}$.
	\end{definition}
	
	\begin{definition}
		Let $X$ be a set, a collection $\mc{A}$ of subsets of $X$ is called a $\sigma$-\textbf{algebra} if
		\begin{enumerate}
			\item $X \in \mc{A}$,
			\item $A \in \mc{A} \implies A^c \in \mc{A}$,
			\item $A_1, A_2 \dots, \in \mc{A}, \implies \bigcup_i^\infty A_i \in \mc{A}$.
		\end{enumerate}
	\end{definition}
	
	\begin{example}[trivial examples]
		The power set of $X$ is a $\sigma$-algebra on $X$; $\{\varnothing, X\}$ is a $\sigma$-algebra on $X$.
	\end{example}
	
	\begin{example}[finite/co-finite algebra]
		Let $X$ be an infinite set and $\mc{A}$ be the collection of subsets $A$ such that either $A$ is finite or $A^c$ is finite. $\mc{A}$ is an algebra.
		\begin{proof}
			$X \in \mc{A}$ since $X^c = \varnothing$ is finite. For a $X \in \mc{A}$, if $X$ is finite, then $X^c \in \mc{A}$. If $X$ is infinite, $X^c$ is finite and $X^c \in \mc{A}$. Let $A, B \in \mc{A}$, if both $A$ and $B$ are finite, $A \cup B$ is finite and in $\mc{A}$. If $A$ is finite and $B$ is co-finite, then $(A \cup B)^c = A^c \cap B^c \subseteq B^c$ is finite. If both $A$ and $B$ are co-finite, $(A \cup B)^c$ is finite so that $A \cup B \in \mc{A}$.
		\end{proof}
		Note the $\mc{A}$ is \ul{not} a $\sigma$-algebra if $X$ is infinite: take distinct points $x_1, x_2, \dots \in \mc{A}$, then the union of them is neither finite or co-finite, and therefore not in $\mc{A}$.
	\end{example}
	
	\begin{example}[countable/co-countable $\sigma$-algebra]
		The collection of subsets $A \subseteq X$, such that either $A$ is countable or $A^c$ is countable, forms a $\sigma$-algebra.
	\end{example}
	
	\begin{example}
		Let $X = \R$ and $\mc{A}$ be the collection of all \ul{finite} \ul{disjoint} unions of half-open intervals (i.e., sets like $(a, b], (-\infty, b], (a, \infty)$), $\mc{A}$ is an algebra. (Not working for open intervals).
	\end{example}
	
	\begin{example}[counter example]
		Let $X$ be an infinite set, $\mc{A}$ be the collection of finite subsets of $X$. Then, $\mc{A}$ is \ul{not} an algebra.
	\end{example}
	
	\begin{proposition}
		Let $X$ be a set and $\{\mc{A}_i\}_{i \in \mc{I}}$ be an arbitrary (not necessarily countable) collection of $\sigma$-algebras, then $\bigcap_{i \in \mc{I}} \mc{A}_i$ is a $\sigma$-algebra.
		\begin{proof}
			Since $X \in \mc{A}_i$ for all $i \in \mc{I}$
		\end{proof}
	\end{proposition}
	
	\begin{corollary}
		Let $X$ be a set, and $\mc{P}$ is an arbitrary collection of subsets of $X$, then $\exists !$ smallest $\sigma$-algebra $\mc{A}$ containing $\mc{P}$. That is, for any $\sigma$-algebra $\mc{B} \supseteq \mc{P}$, $\mc{A} \subseteq \mc{B}$. $\mc{A}$ is defined as the $\sigma$-algebra \textbf{generated by} $\mc{P}$, denoted as $\sigma(\mc{P})$.
	\end{corollary}
	
	\begin{proof}
		For any $\mc{P}$, the power set of $X$ is obviously a $\sigma$-algebra containing $\mc{P}$. Then we can take $\mc{A}$ as the intersection of all $\sigma$-algebras containing $\mc{P}$.
	\end{proof}
	
	\subsection{Borel $\sigma$-algebra}
	\begin{definition}
		The \textbf{Borel \salg} of $\R$, denoted as $\mc{B}(\R)$, is the \salg generated by the set of \ul{open intervals} in $\R$.
	\end{definition}
	
	\begin{fact}
		$\mc{B}(\R)$ is generated by the collection of all closed intervals as well.
		\begin{proof}
			Let $\mc{F}$ denote the \salg generated by all closed intervals. Any open interval can be written as a countable union of closed sets: $(a, b) = \bigcup_{n=1}^\infty [a+1/n, b-1/n]$, therefore $(a, b) \in \mc{F}$ and $\mc{B}(\R) \subseteq \mc{F}$.
			
			Similarly, $[a, b] = \bigcap_{n=1}^\infty (a-1/n, b+1/n)$, hence $\mc{B}(\R)$ is a \salg contains all closed sets. Therefore, $\mc{F} \subseteq \mc{B}(\R)$.
		\end{proof}
	\end{fact}
	
	\begin{fact}
		$\mc{B}(\R)$ is generated by \begin{enumerate}
			\item all open sets,
			\item all closed sets,
			\item all half-open intervals.
		\end{enumerate}
	\end{fact}
	
	\begin{example}[counter example]
		\br is \ul{not} generated by the collection of singletons.
		\begin{proof}
			
		\end{proof}
	\end{example}
	
	\begin{definition}
		The Borel algebra of $\R^d$, $\mc{B}(\R^d)$, is the \salg generated by
		\begin{enumerate}
			\item all open sets in $\R^d$,
			\item all closed sets in $\R^d$,
			\item all closed cubes (regions) in $\R^d$: $\prod_{i=1}^d [a_i, b_i]$.
		\end{enumerate}
	\end{definition}
	
	\subsection{Measures}
	\begin{definition}
		For a set $X$ and a \salg $\mc{A}$ of $X$, the pair $(X, \mc{A})$ is called a \textbf{measurable space}.
	\end{definition}
	
	\begin{definition}
		A \textbf{measure} $\mu$ on a measurable space $(X, \mc{A})$ is a map $\mu: \mc{A} \to [0, \infty]$ such that
		\begin{enumerate}
			\item $\mu(\varnothing) = 0$,
			\item $\mu(\cup_i^\infty A_i) = \sum_{i}^\infty \mu(A_i)$ for disjoint sequence $(A_i)$
		\end{enumerate}
		For now, we don't require the translation invariance property.
		
		The triple $(X, \mc{A}, \mu)$ is called a \textbf{measure space}.
	\end{definition}
	
	\begin{example}[counting measure]
		
	\end{example}
	
	\begin{example}[point-mass measure]
		
	\end{example}
	
	\begin{proposition}
		A measure $\mu$ possesses the following basic properties:
		\begin{enumerate}
			\item (Monotonicity) $A \subseteq B \implies \mu(A) \leq \mu(B)$.
			\item (Sub-additivity) $\mu(\bigcup_{i=1}^\infty A_i) \leq \sum_{i=1}^\infty \mu(A_i)$.
			\item Let $A_1 \subseteq A_2 \subseteq \dots$ be an increasing set, let $\cup_{i=1}^\infty A_i$ denoted $A_i \nearrow A$, $\mu(A) = \lim_{n \to \infty} \mu(A_n)$.
			\item If $A_1 \searrow A \equiv \cap_{i=1}^\infty A_i$, and \red{there exists $\mu(A_i) < \infty$}, then $\mu(A) = \lim_{n \to \infty} \mu(A_n)$.
		\end{enumerate}
		\begin{proof}
			
		\end{proof}
	\end{proposition}
	
	\begin{example}[counter example]
		Let $X = \Z$, $\mc{A} = 2^\Z$ and $\mu$ be the counting measure. Define $A_i = \{i, i+1, \dots \}$, then $A_i \searrow A = \varnothing$, but $\lim_{n \to \infty} \mu(A_n) = \infty \neq \mu(\varnothing)$.
	\end{example}
	
	\subsection{Outer Measure}
	\begin{definition}
		Let $X$ be a set, $\mu^*: 2^X \to [0, \infty]$ is an \textbf{outer measure} if
		\begin{enumerate}
			\item $\mu^*(\varnothing) = 0$.
			\item $\mu^*(A) \leq \mu^*(B)$ whenever $A \subseteq B$.
			\item (countable sub-additivity) $\mu^*(\cup_{i=1}^\infty A_i) \leq \sum_{i=1}^\infty \mu^*(A_i)$.
		\end{enumerate}
		Key difference between outer measure and measure:
		\begin{enumerate}
			\item Outer measure does not require countable additivity,
			\item outer measure is defined on $2^X$ instead of a \salg.
		\end{enumerate}
	\end{definition}
	
	\begin{example}
		
	\end{example}
	
	\subsection{Lebesgue Measure on $\R$}
	\begin{definition}
		Let $A \subseteq \R$, define the \textbf{Lebesgue outer measure}:
		\begin{align}
			\lambda^*(A) = \inf \left\{
			\sum_{i \in \N} b_i - a_i : A \subseteq \bigcup_{i \in \N} (a_i, b_i)
			\right\}
		\end{align}
		The Lebesgue outer measure of a set $A$ is simply in the infimum of total lengths (the conventional notion of length) of open intervals cover $A$.
	\end{definition}
	
	\begin{proposition}
		The Lebesgue measure satisfies the following properties:
		\begin{enumerate}
			\item $\lambda^*$ is an outer measure on $\R$,
			\item $\lambda^*([a, b]) = b - a$ for all $a < b$.
		\end{enumerate}
		\begin{proof}
			(1.1) $\lambda^*(\varnothing) = 0$ since $(-\varepsilon, \varepsilon)$ covers $\varnothing$ for arbitrarily small $\varepsilon$.
			
			(1.2) Let $A \subseteq B$, $\Omega_A$ and $\Omega_B$ be collection of sequences of open intervals covering $A$ and $B$ respectively.
			Then, any cover of $B$ must be a cover of $A$, that is, $\Omega_A \subseteq \Omega_B$.
			Therefore, $\lambda^*(A) \leq \lambda^*(B)$.
			
			(1.3) Let $A_1, A_2, \dots \subseteq \R$ and $A = \bigcup_{i=1}^\infty A_i$. For all $i$, we may find $(a_{ij}, b_{ij})$ covers $A_i$ such that
			\begin{align}
				\sum_{j=1}^\infty (b_{ij} - b_{ij}) \leq  \lambda^*(A_i) + \varepsilon 2^{-i}
			\end{align}
			Also, $\{(a_{ij}, b_{ij})\}_{i,j}$ is a countable union of open intervals that covers $A$.
			\begin{align}
				\lambda^*(A) &\leq \sum_{i=1}^\infty \sum_{j=1}^\infty (b_{ij} - a_{ij}) \\
				&\leq \sum_{i=1}^\infty (\lambda^*(A_i) + \varepsilon 2^{-i}) \\
				&=\sum_{i=1}^\infty \lambda^*(A_i) + \varepsilon
			\end{align}
			Therefore, $\lambda^*(A) \leq \sum_{i=1}^\infty \lambda^*(A_i)$.
			
			(2) Note that $[a, b] \subseteq (a-\varepsilon, b+\varepsilon)$ for all $\varepsilon > 0$.
			Therefore,
			\begin{align}
				\lambda^*([a, b]) \leq \inf_{\varepsilon > 0} \lambda^*(a-\varepsilon, b+\varepsilon) = b - a
			\end{align}
			Now show $\lambda^*([a, b]) \geq b - a$.
			We want to show that $\sum_{i=1}^\infty (b_i - a_i) \geq b - a$ for all possible covering of $[a, b]$, which implies the infimum of them is at least $b - a$.
			
			Take an arbitrary covering $\{(a_i, b_i)\}_i$ of $[a, b]$.
			Since $[a, b]$ is compact, there exists a finite covering $[a, b] \subseteq \bigcup_{i=1}^n (a_i, b_i)$ (reindexed), it suffices to show the finite sum $\sum_{i=1}^\infty (b_i - a_i) \geq b - a$.
			
			(1) We firstly define an \emph{interval} to be any open, closed or half-open intervals. The \emph{length} of an interval is the difference between two end points.
			
			Note that if an interval $I$ contains a finite collection of disjoint sub-intervals, then the length of $I$ is at least the sum of lengths of sub-intervals. The equality holds when $I$ is exactly finite union of disjoint sub-intervals.
			
			(2) Suppose $[a, b] \subseteq \bigcup_{i=1}^n (a_i, b_i)$, let $I_i = [a, b] \cap (a_i, b_i)$.
			Easy to verify that the length of $I_i \leq$ length of $(a_i, b_i) = b_i - a_i$.
			Moreover, $\bigcup_{i=1}^n I_i = [a, b] \cup \bigcup_{i=1}^n (a_i, b_i) = [a, b]$.
			
			(3) For all $i$, define $I'_i = I_i \backslash (I_1 \cup I_2 \cup \dots \cup I_{i-1})$. This procedure allows us to express $[a, b]$ as a finite union of disjoint sub-intervals: $[a, b] = \bigcup_{i=1}^n I'_i$. Each $I'_i$ is a finite union of disjoint intervals as well, the conventional notion of $I'_i$ is well-defined.
			Then $b - a = $ sum of lengths of $I'_i$.
			
			However, $\ell(I'_i) \leq \ell(I_i) \leq b_i - a_i$ and sum of lengths of $I_i' \leq$ sum of lengths of $I_i \leq \sum_{i=1}^n b_i - a_i$.
			Therefore, $b - a \leq \sum_{i=1}^n b_i - a_i \leq \sum_{i=1}^\infty b_i - a_i$.
			Hence, $b - a = \sum_{i=1}^\infty b_i - a_i$ and $\lambda^*[a, b] = b - a$ consequently.
		\end{proof}
	\end{proposition}
	
	\subsection{Construct Lebesgue Measure}
	
	\begin{definition}
		Let $X$ be a set with outer measure $\mu^*$. A set $B \subseteq X$ is $\mu^*$-\textbf{measurable} if
		\begin{align}
			\forall A \subseteq X, \mu^*(A) = \mu^*(A \cap B) + \mu^*(A \cap B^c)
		\end{align}
	\end{definition}
	
	\begin{theorem}
		For any set $X$ with outer measure $\mu^*$ on it, let $\mc{M}_{\mu^*}$ denote the set of all $\mu^*$-\textbf{measurable} sets. Then, $\mc{M}_{\mu^*}$ is a \salg and $\mu^*|_{\mc{M}_{\mu^*}}$ ($\mu^*$ restricted to $\mc{M}_{\mu^*}$) is a measure.
	\end{theorem}
	
	\begin{proof}
		To show $B$ is $\mu^*$-measurable, it suffices to show that $\forall A \subseteq X, \mu^*(A) \geq \mu^*(A \cap B) + \mu^*(A \cap B^c)$, because the opposite inequality always holds by sub-additivity.
		
		(1.1) Let $A \subseteq X$, $\mu^*(A \cap \varnothing) + \mu^*(A \cap \varnothing^c) = \mu^*(A \cap \varnothing^c) = \mu^*(A)$, therefore, $\varnothing \in \mc{M}_{\mu^*}$.
		
		(1.2) Let $A \subseteq X$ and $B \in \mc{M}_{\mu^*}$, $\mu^*(A) = \mu^*(A \cap B) + \mu^*(A \cap B^c) = \mu^*(A \cap (B^c)^c) + \mu^*(A \cap B^c)$. Hence, $B^c \in \mc{M}_{\mu^*}$.
		
		(1.3.1) Let $B_1, B_2 \in \mc{M}_{\mu^*}$, we are going to show $B_1 \cup B_2 \in \mc{M}_{\mu^*}$.
		Fix any $A \subseteq X$, 
		\begin{align}
			\mu^*(A \cap (B_1 \cup B_2)) &= \mu^*(A \cap (B_1 \cup B_2) \cap B_1) + \mu^*(A \cap (B_1 \cup B_2) \cap B_1^c) \\
			&= \mu^*(A \cap B_1) + \mu^*(A \cap B_1^c \cap B_2)
		\end{align}
		Moreover,
		\begin{align}
			\mu^*(A \cap (B_1 \cup B_2)^c) &= \mu^*(A \cap B_1^c \cap B_2^c)
		\end{align}
		Therefore,
		\begin{align}
			\mu^*(A \cap (B_1 \cup B_2)) + \mu^*(A \cap (B_1 \cup B_2)^c) &= \mu^*(A \cap B_1) + \mu^*(A \cap B_1^c \cap B_2) +  \mu^*(A \cap B_1^c \cap B_2^c) \\
			&= \mu^*(A \cap B_1) + \mu^*(A \cap B_1^c) \tx{ since } B_2 \in \mc{M}_{\mu^*} \\
			&= \mu^*(A) \tx{ since } B_1 \in \mc{M}_{\mu^*}
		\end{align}
		Therefore, $\mc{M}_{\mu^*}$ is an algebra.
		
		(1.3.2) Now show that $\mc{M}_{\mu^*}$ is a \salg. For any sequence of sets $A_i \in \mc{M}_{\mu^*}$, we can define $B_n := A_n \backslash \cup_{j=1}^{i-1} A_j$ such that $\cup B_i = \cup A_i$.
		Therefore, it is suffices to show $\mc{M}_{\mu^*}$ is closed under countable disjoint unions.
		
		We are going to show the union $\cup B_i$ is $\mu^*$-measurable for any disjoint sequence of $\mu^*$-measurable $B_i$'s.
		
		Claim: let $A \subseteq X$, $\mu^*(A) = \sum_{i=1}^n \mu^*(A \cap B_i) + \mu^*(A \cap (\cup_{i=1}^n B_i)^c)$.
		The claim can be proved by induction on $n$.
		
		When $n = 1$, $\mu^*(A) = \mu^*(A \cap B) + \mu^*(A \cap B^c)$ because $B_1$ is $\mu^*$-measurable.
		
		Suppose the claim holds for $n$, then
		\begin{align}
			\mu^*(A \cap (\cup_{i=1}^n B_i)^c) &= \mu^*(A \cap (\cup_{i=1}^n B_i)^c \cap B_{n+1}) + \mu^*(A \cap (\cup_{i=1}^n B_i)^c \cap B_{n+1}^c)
		\end{align}
		because $B_{n+1} \in \mc{M}_{\mu^*}$. Moreover, since all $B_i$'s are disjoint, $B_{n+1} \subseteq B_{i}^c$ for all $i$.
		Hence, 
		\begin{align}
			B_{n+1} \subseteq \cap_{i=1}^n B_i^c = (\cup_{i=1}^n B_i)^c
		\end{align}
		Also,
		\begin{align}
			(\cup_{i=1}^n B_i)^c \cap B_{n+1}^c = \cap_{i=1}^{n+1} B_i^c
		\end{align}
		Consequently,
		\begin{align}
			\mu^*(A \cap (\cup_{i=1}^n B_i)^c) &= \mu^*(A \cap B_{n+1}) + \mu^*(A \cap (\cup_{i=1}^{n+1} B_i)^c)
		\end{align}
		Hence,
		\begin{align}
			\mu^*(A) &= \sum_{i=1}^n \mu^*(A \cap B_i) + \mu^*(A \cap (\cap_{i=1}^n B_i^c)) \\
			&\geq \sum_{i=1}^n \mu^*(A \cap B_i) + \mu^*(A \cap (\cap_{i=1}^\infty B_i^c)) \\
			&= \sum_{i=1}^n \mu^*(A \cap B_i) + \mu^*(A \cap (\cup_{i=1}^\infty B_i)^c) 
		\end{align}
		Take $n \to \infty$
		\begin{align}
			\mu^*(A) &\geq \sum_{i=1}^\infty \mu^*(A \cap B_i) + \mu^*(A \cap (\cup_{i=1}^\infty B_i)^c) \\
			&\geq \mu^*(A \cap \cup_{i=1}^\infty B_i) + \mu^*(A \cap (\cup_{i=1}^\infty B_i)^c)
		\end{align}
		Therefore, $\cup_{i=1}^\infty B_i$ is $\mu^*$-measurable.
		
		(2) Let $B_1, B_2, \dots$ be a sequence of disjoint sets from $\mc{M}_{\mu^*}$. Using the above fact and take $A = \cup_{i=1}^\infty B_i$,
		\begin{align}
			\mu^*(A) \geq \mu^*(\cup_{i=1}^\infty B_i) + \mu^*(\varnothing) = \mu^*(\cup_{i=1}^\infty B_i)
		\end{align}
		The opposite inequality holds by sub-additivity. Therefore, $\mu^*$ is a measure on $\mc{M}_{\mu^*}$.
	\end{proof}
	
	\begin{definition}
		Let $\lambda^*$ be the Lebesgue outer measure on $\R$, then the collection $\mc{M}_{\lambda^*}$ of $\lambda^*$-measurable sets is called the \textbf{Lebesgue \salg}. The restriction $\lambda = \lambda^*|_{\mc{M}_{\lambda^*}}$, which is a measure on $\mc{M}_{\lambda^*}$, is called the \textbf{Lebesgue measure}. Any set in $\mc{M}_{\lambda^*}$ is called a \textbf{Lebesgue measurable set}.
	\end{definition}
	
	\begin{theorem}
		\br $\subseteq \mc{M}_{\lambda^*}$.
		\begin{proof}
			Note that $\{(-\infty, b]:b\in\R\}$ generates \br, it suffices to show $\{(-\infty, b]:b\in\R\} \subseteq \mc{M}_{\lambda^*}$.
			
			Let $B = (-\infty, b]$, we are going to show $B$ is $\lambda^*$-measurable. Let $A \subseteq \R$ and $(a_n, b_n)$ be a sequence of open intervals covers $A$. For every $n \in \N$,
			\begin{align}
				\lambda^*((a_n, b_n) \cap B) + \lambda^*((a_n, b_n) \cap B^c) = \lambda^*((a_n, b_n) \cap (-\infty, b]) + \lambda^*((a_n, b_n) \cap (b, \infty))
			\end{align}
			Three cases follow:
			\begin{enumerate}
				\item $b > b_n$: $\lambda^*((a_n, b_n) \cap B) + \lambda^*((a_n, b_n) \cap B^c) = \lambda^*((a_n, b_n)) = b_n - a_n$.
				\item $b_n > b > a_n$:  $\lambda^*((a_n, b_n) \cap B) + \lambda^*((a_n, b_n) \cap B^c) = \lambda^*((a_n, b]) + \lambda^*((b, b_n]) = b_n - a_n$.
				\item $a_n > b$: $\lambda^*((a_n, b_n) \cap B) + \lambda^*((a_n, b_n) \cap B^c) = \lambda^*((a_n, b_n)) = b_n - a_n$.
			\end{enumerate}
			Therefore,
			\begin{align}
				\lambda^*((a_n, b_n) \cap B) + \lambda^*((a_n, b_n) \cap B^c) = b_n - a_n
			\end{align}
			By monotonicity and sub-additivity:
			\begin{align}
				\lambda^*(A \cap B) + \lambda^*(A \cap B^c) &\leq \lambda^*(\cup (a_n, b_n) \cap B) + \lambda^* (\cup (a_n, b_n) \cap B^c ) \\
				&\leq \sum \lambda^*((a_n, b_n) \cap B) + \lambda^*((a_n, b_n) \cap B^c) \\
				&= \sum_{n=1}^\infty b_n - a_n
			\end{align}
			Take the infimum of all such covering, we can show
			\begin{align}
				\lambda^*(A \cap B) + \lambda^*(A \cap B^c) &\leq \lambda^*(A)
			\end{align}
			Therefore, $B$ is $\mu^*$-measurable and $\mc{M}_{\lambda^*}$ is a \salg containing all such intervals and \br $\subseteq \mc{M}_{\lambda^*}$.
		\end{proof}
	\end{theorem}
	
	\subsection{Lebesgue Measure on $\R^d$}
	\begin{definition}
		Steps to construct Lebesgue measure on $\R^d$:
		\begin{enumerate}
			\item Define open cubes on $\R^d$ as a Cartesian product of open intervals: $Q := \prod_{i=1}^d (a_i, b_i)$. Define Lebesgue outer measure:
			\begin{align}
				\lambda^*(A) := \inf \left\{ \sum_{n=1}^\infty \prod_{i=1}^d (b_{ni} - a_{ni}) : A \subseteq \bigcup_{n=1}^\infty Q_n \right\}
			\end{align}
			\item Show $\lambda^*$ is an outer measure and $\lambda^*(Q) = \prod_{i=1}^d (b_{i} - a_{i})$.
			\item $\mc{M}_{\lambda^*}$ is the Lebesgue \salg on $\R^d$. Restricting $\lambda^*$ on $\mc{M}_{\lambda^*}$ defines the Lebesgue measure.
			\item Show that any Borel set in $\R^d$ is Lebesgue measurable by showing that there is a generating set of \brd is in $\mc{M}_{\lambda^*}$.
		\end{enumerate}
	\end{definition}
	
	\subsection{Uniqueness of the Lebesgue Measure}
	\paragraph{The next goal} is to prove the uniqueness of Lebesgue measure on \brd subject to the criterion that the measure of any interval (cube) is the volume in the usual sense (product of side lengths).

	\begin{theorem}
		Let $\lambda$ be the Lebesgue measure on $\R^d$, then for any Lebesgue measurable set $A$,
		\begin{enumerate}
			\item $\lambda(A) = \inf \{\lambda(U) : \tx{open } U \supseteq A\}$,
			\item $\lambda(A) = \sup \{\lambda(K) : \tx{compact } K \subseteq A\}$.
		\end{enumerate}
		\begin{proof}
			(1.1) WLOG $\lambda(A) < \infty$, by monotonicity, $\lambda(A) \leq \lambda(U)$ for any open cover, $\lambda(A) \leq \inf \{..\}$.
			
			(1.2)Let $\varepsilon > 0$, $\exists$ a sequence of open intervals $(R_i)$ such that 
			\begin{align}
				\lambda(A) \leq \sum^\infty_{i=1} \lambda(R_i) \leq \lambda(A) + \varepsilon
			\end{align}
			Let $U := \cup R_i$ open, hence $\inf \{..\} \leq \lambda(U) \leq \sum^\infty_{i=1} \lambda(R_i) \leq \lambda(A) + \varepsilon$. Since this $\varepsilon$ can be arbitrarily small, we conclude $\inf\{..\} \leq \lambda(A)$.
			
			(2.1) let $A$ be a Lebesgue measurable set, \ul{assume $A$ is bounded}, so that $\lambda(A) < \infty$. Then there exists a compact $C \supseteq A$. $C \backslash A$ is Lebesgue measurable as well.
			
			By conclusion of part (1), there exists a open set $U \supseteq C \backslash A$ such that 
			\begin{align}
				\lambda(C \backslash A) \leq \lambda(U) \leq \lambda(C \backslash A) + \varepsilon
			\end{align}
			Let $K = C \backslash U$, $K$ is compact. Moreover, let $a \in K$, then $a \in C$ and $a \notin U$. Therefore, $a \notin C \backslash A$, it must be $x \in A$. Hence, $K \subseteq A$.
			\begin{align}
				\lambda(K) &= \lambda(C \backslash U) \\
				&\geq \lambda(C) - \lambda(U) \\
				&\geq \lambda(C) - (\lambda(C \backslash A) + \varepsilon) \\
				&=\lambda(C) - \lambda(C) + \lambda(A) - \varepsilon \\
				&=\lambda(A) - \varepsilon
			\end{align}
			Take $\varepsilon \to 0$ and $\lambda(A) \leq \sup \{..\}$. By monotonicity, $\lambda(A) \geq \sup \{..\}$.
			
			(2.2) Other cases: suppose $A$ is unbounded and $\lambda(A) > 0$. Take an arbitrary $b < \lambda(A)$. We will show that $\sup\{..\} \geq b$, this will prove that $\lambda(A) \leq \sup\{...\}$.
			
			To show $\sup\{..\} \geq b$, it suffices to show that there exists a compact set $K \subseteq A$ such that $\lambda(K) \geq b$.
			
			Let $\{C_j\}_{j=1}^\infty$ be a sequence of compact sets increasing to $\R^d$.
			
			Then $A \cap C_j \uparrow A$ and $\lambda(A \cap C_1) < \infty$, which implies $\lambda(A) = \lim_{j \to \infty} \uparrow \lambda(A \cap C_j)$. Since $b < \lambda(A)$, there exists $j$ such that $\lambda(A \cap C_j) \geq b$, where $A \cap C_j$ is compact. Hence, $b \leq \sup\{..\}$ and $\lambda(A) \leq \sup\{..\}$.
			$\lambda(A) \geq \sup\{..\}$ holds by monotonicity.
			
			When $\lambda(A) = 0$, $0 \leq \lambda(K)$ for all $K$ so that $0 \leq \sup\{..\}$. The opposite inequality holds by monotonicity.
		\end{proof}
	\end{theorem}


	\begin{lemma}
		For each $k \in \Z$, define \textbf{dyadic cubes} in $\R^d$ as set in the following form:
		\begin{align}
			\prod_{i=1}^d [j_i 2^{-k}, (j_i + 1) 2^{-k})
		\end{align}
		where $j_i \in \Z$ for every $i$. Let $\mc{D}$ denote the collection of dyadic cubes.

		Then, any open set $U \subseteq \R^d$ can be expressed as a \ul{countable} union of some members of $\mc{D}$.
		
		A dyadic cube of side length $2^{-k}$ has a unique parent of side length $2^{-k+1}$ and a unique grandparent with side length $2^{-k+2}$.
		
		\begin{proof}
			Given open set $U$, let $\mc{D}_U$ denote the set of all dyadic half open cubes $D$ such that $D \subseteq U$ but the parent of $U$ does not fully contain $U$.
			
			Claim 1: $U = \bigcup_{D \in \mc{D}_U} D$. Obviously, $\bigcup_{D \in \mc{D}_U} \subseteq U$.
			To show the converse, take any $x \in U$, since $U$ is open, there exists $D \in \mc{D}_U$ such that $x \in D \subseteq U$.
			
			Let $D_0$ be the \ul{earliest} ancestor of $D$ such that $x \in D_0 \subseteq U$. Obviously, $D_0 \in \mc{D}_U$. Therefore, $U \subseteq \bigcup_{D \in \mc{D}_U} D$.
			
			Claim 2: Two dyadic cubes can overlap if and only if one is the ancestor of the other. By construction, dyadic cubes in $\mc{D}_U$ are disjoint.
			
			Claim 3: $\mc{D}_U$ is countable because $\mc{D}$ is itself countable.
		\end{proof}
	\end{lemma}

	\begin{proposition}
		Lebesgue measure is the only measure on $(\R^d, \mc{B}(\R^d))$ which assigns the \emph{correct volume} to any $d$-dimensional intervals or even any $d$-dimensional dyadic cube.
		\begin{proof}
			Let $\lambda$ denote the Lebesgue measure, let $\mu$ be another measure satisfying the desired property.
			
			By lemma, for all open set $U$, $\mu(U) = \sum_{j=1}^\infty \mu(D_j) = \sum_{j=1}^\infty \lambda(D_j) = \lambda(U)$, where $\{D_j\}$ is a collection of disjoint dyadic cubes contains with union $U$.
			Therefore, \ul{$\lambda(A) = \mu(A)$ for all open Borel set $A$}.
			
			Let $A \in \mc{B}(\R^d)$, let open $U \supseteq A$, then $\mu(A) \leq \mu(U) = \lambda(U)$ for all $U$.
			Taking the infimum over all $U \supseteq A$, we conclude \ul{$\mu(A) \leq \lambda(A)$ for all Borel set $A$}.

			Next, take any \ul{bounded} Borel set $A$, let $V$ be a bounded open set containing $A$. Then,
			\begin{align}
				\mu(V) &= \mu(A) + \mu(V \backslash A) \\
				&\leq \lambda(A) + \lambda(V \backslash A) \\
				&= \lambda(V)
			\end{align}
			But we also know that $\mu(V) = \lambda(V)$ since $V$ is open, the inequality holds as equality. Moreover, the previous conclusion implies $\mu(A) \leq \lambda(A)$ and $\mu(V \backslash A) \leq \lambda(V \backslash A)$, it must be $\mu(A) = \lambda(A)$ and $\mu(V \backslash A) = \lambda(V \backslash A)$. Therefore, \ul{$\mu(A) = \lambda(A)$ for all bounded Borel set $A$}.
			
			Lastly, any Borel set can be written as a a countable disjoint union of bounded Borel set, therefore, \ul{$\mu(A) = \lambda(A)$ for all Borel set $A$}.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}
		The Lebesgue outer measure on $\R^d$ is translation invariant. In particular, Lebesgue measure is translation invariant and any translation of Lebesgue measurable set is Lebesgue measurable.
		\begin{proof}
			$\lambda^*(A + x) = \lambda^*(A)$ follows the definition of $\lambda^*$: translate all covering intervals by $+x$ and the volumes of these intervals stay the same. Since $\lambda$ is simply the restriction of $\lambda^*$ on Lebesgue measurable sets, $\lambda$ is translation invariant as well.
			
			Now take Lebesgue measurable $B$, for all$A \subseteq \R^d$:
			\begin{align}
				\lambda^*(A) &= \lambda^*(A \cap B) + \lambda^*(A \cap B^c) \\
				\implies \lambda^*(A-x) &= \lambda^*((A-x) \cap B) + \lambda^*((A-x) \cap B^c)
			\end{align}
			Note that
			\begin{align}
				(A - x) + x &= A \\
				(A - x) \cap B + x &= A \cap (B + x) \\
				(A - x) \cap B^c + x &= A \cap (B + x)^c
			\end{align}
			By translational invariance of $\lambda^*$, 
			\begin{align}
				\lambda^*(A) = \lambda^*(A \cap (B+x)) + \lambda^*(A \cap (B+x)^c)
			\end{align}
			Therefore, $B + x$ is Lebesgue measurable as well.
		\end{proof}
	\end{proposition}

	\begin{theorem}
		Let $\mu$ be a non-zero measure on $(\R^d, \mc{B}(\R^d)$, which is finite on bounded Borel sets and translation invariant. Then, $\mu(A) = c \lambda(A)$ for all $A \in \mc{B}(\R^d)$, where $\lambda$ is the Lebesgue measure.
	\end{theorem}
	
	\begin{remark}
		Borel \salg is closed under translation.
	\end{remark}
	
	\begin{proof}
		Let $c = \mu([0, 1)^d) \in (0, \infty)$. Then $[0, 1)^d$ is the disjoint union of $2^{dk}$ half-open dyadic intervals with side length $2^{-k}$. All of these sub-intervals have the same $\mu$ since $\mu$ is translation invariant. Therefore, for every dyadic sub-interval with side length $2^{-k}$, $\mu(D) = 2^{-dk} c$.
		
		Let $\nu(A) = \frac{1}{c} \mu(A)$, then $\nu$ is a measure that is finite on bounded sets and agrees with $\lambda$ on all half-open dyadic cubes. By the previous proposition, $\lambda$ is the only measure assign correct volumes to dyadic cubes, therefore, $\nu = \lambda$.
	\end{proof}
	
	\begin{theorem}
		Under the axiom of choice, there exists a non-Lebesgue subset of $\R$.
	\end{theorem}
	
	\begin{proof}
		Todo.
	\end{proof}

	\section{Functions}
	\subsection{Measurable Functions}
	\begin{definition}
		A function $f: (X, \mc{A}) \to (Y, \mc{B})$ is \textbf{measurable} if $f^{-1}(B) \in \mc{A}$ for all $B \in \mc{B}$.
	\end{definition}
	In this course, we mainly consider functions with extended-$\R$ as codomain: $Y = [-\infty, \infty]$, denoted as $\R^*$.
	\begin{definition}
		The \salg on $\R^*$ is defined to be the \salg generated by $\mc{B}(\R) \cup \{-\infty\} \cup \{\infty\}$.
	\end{definition}
	
	\begin{proposition}
		\begin{align}
			\sigma(\mc{B}(\R) \cup \{-\infty\} \cup \{\infty\}) &= \mc{B}(\R) \cup \{B \cup \{\infty\}: B \in \mc{B}(\R)\} \\
			&\quad \cup \{B \cup \{-\infty\}: B \in \mc{B}(\R)\} \\
			&\quad \cup \{B \cup \{-\infty, \infty\}: B \in \mc{B}(\R)\}
		\end{align}
	\end{proposition}
	
	\begin{proposition}
		Equivalently, $f$ is measurable if for every $t \in \R$,
		\begin{align}
			\{x \in X : f(x) \leq t\} \in \mc{A} \\
			\{x \in X : f(x) < t\} \in \mc{A} \\
			\{x \in X : f(x) \geq t\} \in \mc{A} \\
			\{x \in X : f(x) > t\} \in \mc{A}
		\end{align}
		More generally, to determine the measurability of $f: (X, \mc{A}) \to (Y, \mc{B})$, we only need to check whether $f^{-1}(C) \in \mc{A}$ for all $C$ in a \ul{generating collection} $\mc{C}$ of $\mc{B}$. The converse holds true trivially.

		\begin{proof}
			Let $(X, \mc{A}), (Y, \mc{B})$ be two measurable spaces, let $\mc{C}$ be a collection of subsets of $Y$ generates $\mc{B}$.
			
			($\implies$) Let $f$ be a measurable function, then for every $C \in \mc{C} \subseteq \mc{B}$. Obviously, $f^{-1}(C) \in \mc{A}$ by definition.
			
			($\impliedby$) Suppose $f^{-1}(C) \in \mc{A}$ for all $C \in \mc{C}$. Define
			\begin{align}
				\mc{B}_0 := \{B \in \mc{B} : f^{-1}(B) \in \mc{A}\} \supseteq \mc{C}
			\end{align}
			It's easy to check $\mc{B}_0$ is in fact a \salg: $f^{-1}(\varnothing) = \varnothing \in \mc{A}$, $f^{-1}(B^c) = (f^{-1}(B))^c$, and $f^{-1}(\bigcup B_i) = \bigcup f^{-1}(B_i)$. Therefore, $\mc{B} \subseteq \mc{B}_0$ and all $B \in \mc{B}$ satisfies $f^{-1}(B) \in \mc{A}$.
		\end{proof}
	\end{proposition}
	
	\begin{example}
		$f(x) = \id{x \in \Q}$ is measurable.
	\end{example}
	
	\subsection{Simple Functions}
	\begin{definition}
		A function $f: (X, \mc{A}) \to (\R^*, \mc{B}(\R^*))$ is called \textbf{simple} if there exists \ul{finitely} many \ul{disjoint} sets $A_1, \dots, A_n$ and real numbers $a_1, \dots, a_n$ such that
		\begin{align}
			f(x) = \begin{cases}
				a_i &\tx{ if } x \in A_i \\
				0 &\tx{ if } x \notin A_i \forall i \in [n]
			 \end{cases}
		\end{align}
		Let $\mathds{S}$ denote the set of simple functions, and $\mathds{S}^+$ denote the set of non-negative simple functions.
	\end{definition}
	
	\begin{proposition}
		All simple functions are measurable.
		\begin{proof}
			For any subset of $\R^*$, the pre-image is either $X$ or a union of some (potentially none) $A_i$'s.
		\end{proof}
	\end{proposition}
	
	\subsection{Properties of Measurable Functions}
	
	\begin{example}
		Let $f: \R^d \to \R$, then all of the following functions are measurable:
		\begin{align}
			f(x, y) &= x + y \\
			f(x, y) &= \max\{x, y\} \equiv x \lor y \\
			f(x, y) &= \min\{x, y\} \equiv x \land y \\
			f(x, y) &= x - y \\
			f(x, y) &= \alpha x\quad \alpha \in \R
		\end{align}
	\end{example}
	
	\begin{proposition}[Component-wise Measurable Functions]
		Let $f, g: (X, \mc{A}) \to (\R^*, \mc{B}(\R^*))$ be measurable, let $h(x) = (f(x), g(x)) \in \R^{*2}$, then $f$ is measurable.
		\begin{proof}
			\begin{align}
				h^{-1}([-\infty, t] \times [-\infty, s]) = f^{-1}([-\infty, t]) \cap g^{-1}([-\infty, s]) \in \mc{A}
			\end{align}
			And, $\mc{B}(\R^*)$ can be generated by sets with forms $[-\infty, t] \times [-\infty, s]$.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}[Composite of Measurable Functions]
		Let $(X, \mc{A}), (Y, \mc{B}), (Z, \mc{C})$ be measurable spaces, let $f: X \to Y$ and $g: Y \to Z$ be measurable functions. Then, the composite $g \circ f: X \to Z$ is measurable.
	\end{proposition}
	
	\begin{corollary}
		Let $f, g: X \to \R$ be measurable functions, then $f+g$, $f-g$, $\max\{f,g\}$, and $\min\{f,g\}$ are all measurable.
		\begin{proof}
			$f+g$ and $f-g$ can be written as the composition of $h_1(x) = (f(x), g(x))$ and $h_2(x, y) = x \pm y$, which are all measurable.
			
			$f \lor g$ and $f \land g$ are measurable as special cases of next proposition.
		\end{proof}
	\end{corollary}
	
	\begin{proposition}
		Let $f_1, f_2, \dots$ be a sequence of measurable maps from $(X, \mc{A}) \to (\R^*, \mc{B}(\R^*))$, then $\sup_n f_n$ and $\inf_n f_n$ are measurable.
		\begin{proof}
			Note $\{x \in X : \sup_n f_n \leq t\} = \bigcup_{n=1}^\infty \{x \in X : f_n \leq t\} \in \mc{A}$ for every $t$, therefore the supremum is measurable.
		\end{proof}
	\end{proposition}
	
	\begin{corollary}
		$\limsup f_n$ and $\liminf f_n$ are measurable.
		\begin{proof}
			Let $g_k = \sup_{n \geq k} f_n$, $g_k$ is measurable. $\limsup f_n = \inf_k g_k$ is measurable as well. Similar proof for the measurability of $\liminf f_n$.
		\end{proof}
	\end{corollary}
	
	\begin{proposition}
		Let $f$ and $g$ be $\R^*$-valued measurable functions. Then sets
		\begin{align}
			\{x \in A: f(x)<g(x)\},\{x \in A: f(x) \leq g(x)\}
		\end{align}
		are measurable.
		\begin{proof}
			\begin{align}
				\{x \in A: f(x)<g(x)\}=\bigcup_{r \in \mathbb{Q}}(\{x \in A: f(x)<r\} \cap\{x \in A: r<g(x)\})
			\end{align}
		\end{proof}
	\end{proposition}
	
	\begin{corollary}
		Let $u, v: X \to \R^*$ be a measurable functions, then $\{x \in X : u(x) = v(x)\}$ is measurable.
		\begin{proof}
			Note that $\{x \in X : u(x) = v(x)\} = \{x \in X : u(x) \leq v(x)\} \cap \{x \in X : u(x) \geq v(x)\}$.
		\end{proof}
	\end{corollary}
	
	\begin{corollary}
		Let $\{f_n\}$ be a sequence of measurable functions from $(X, \mc{A}) \to (\R^*, \mc{B}(\R^*))$. Then,
		\begin{align}
			\{x \in X : \lim_{n \to \infty} f_n(x) \tx{ exists}\}
		\end{align}
		is measurable.
		\begin{proof}
			Note that $\{x \in X : \lim_{n \to \infty} f_n(x) \tx{ exists}\} = \{x \in X :  \liminf f_n(x) = \limsup f_n(x) \}$, the result follows from previous lemma.
		\end{proof}
	\end{corollary}
	
	\begin{corollary}
		If $\{f_n\}$ is a sequence of measurable functions such that $\lim f_n(x)$ exists for all $x \in X$, then $\lim f_n$ is a measurable function on $(X, \mc{A})$.
		\begin{proof}
			In this case, $\{x \in X : \lim_{n \to \infty} f_n(x) \tx{ exists}\} = X$, and $\lim f_n = \liminf f_n$ on $X$.
		\end{proof}
	\end{corollary}
	
	\begin{corollary}
		If $\{f_n\}$ is a sequence of measurable function from $X$ to $[0, \infty]$, then $\sum_{n=1}^\infty f_n$ is measurable.
		\begin{proof}
			Follows the previous corollary directly: define $g_k = \sum_{n=1}^k f_n$ and $\lim_{k \to \infty} g_k = \sum_{n=1}^\infty f_n$.
		\end{proof}
	\end{corollary}

	\section{Integrals}
	\subsection{Integrating Simple Functions}
	\begin{definition}
		Let $f \in \mathds{S}^+$ with representation $\{(A_i, a_i)\}_{i=1}^n$. WLOG, $\bigcup_{i=1}^n A_i = X$. Then, define
		\begin{align}
			\int_X f \ d\mu := \sum_{i=1}^n a_i \mu(A_i)
		\end{align}
	\end{definition}
	
	\begin{proposition}
		The notion of integral on simple functions is well defined. Specifically, let $\{(A_i, a_i)\}_{i=1}^n$ and $\{(B_j, b_j)\}_{j=1}^m$ be any two representations of $f$, $\sum_{i=1}^n a_i \mu(A_i) = \sum_{j=1}^m b_j \mu(B_j)$.
		\begin{proof}
			First note that $\{A_i \cap B_j\}_{i, j}$ are disjoint sets with union $X$. Moreover, for any $i, j$, if $A_i \cap B_j \neq \varnothing$, take some $x \in A_i \cap B_j$, $f(x) = a_i = b_j$. Therefore, $a_i \mu(A_i \cap B_j) = b_i \mu(A_i \cap B_j)$ since either $a_i = b_j$ or $\mu(A_i \cap B_j) = \mu(\varnothing) = 0$.
			\begin{align}
				\sum_{i=1}^n a_i \mu(A_i) &= \sum_{i=1}^n a_i \sum_{j=1}^m \mu(A_i \cap B_j) \\
				&= \sum_{j=1}^m b_j \sum_{i=1}^n \mu(A_i \cap B_j) \\
				&= \sum_{j=1}^m b_j \mu(B_j)
			\end{align}
		\end{proof}
	\end{proposition}
	
	\subsection{Integrating Measurable Functions}
	\begin{definition}
		For a non-negative \ul{measurable} function $f: X \to [0, \infty]$, define its Lebesgue integral as
		\begin{align}
			\int f\ d\mu = \sup \left\{\int g\ d\mu : g \tx{ is a non-negative simple function such that } g \leq f \right\}
		\end{align}
		For any \ul{measurable} $f: X \to [-\infty, \infty]$, let
		\begin{align}
			f^+(x) &= \max\{f(x), 0\} \\
			f^-(x) &= - \min\{f(x), 0\}
		\end{align}
		So that $f = f^+ - f^-$, and $f$ is measurable if and only if both $f^+$ and $f^-$ are measurable.
	
		If at least one of $\int f^+\ d\mu$, $\int f^-\ d\mu$ is finite, the integral of $f$ \ul{exists (well-defined)} and is defined as
		\begin{align}
			\int f\ d\mu = \int f^+\ d\mu - \int f^-\ d\mu	
		\end{align}
		If both $\int f^+\ d\mu$ and $\int f^-\ d\mu$ are finite, $f$ is said to be \textbf{integrable}.
	\end{definition}
	
	\subsection{Properties of Integral of Non-negative Simple Functions}
	\begin{proposition}[Linearity]
		If $f, g$ are \ul{non-negative simple} functions, then
		\begin{align}
			\int f+g\ d\mu = \int f\ d\mu + \int g\ d\mu
		\end{align}
		Moreover, for any $\alpha \geq 0$,
		\begin{align}
			\int \alpha f\ d\mu = \alpha \int f\ d\mu
		\end{align}
		\begin{proof}
			Let $f$ and $g$ be simple functions represented by $\{(A_i, a_i)\}_{i=1}^n$ and $\{(B_j, b_j)\}_{j=1}^m$. WLOG, $\cup A_i = \cup B_j = X$. Then $f + g$ is a simple function with representation $\{(A_i \cap B_j, a_i + b_j)\}_{i,j}$, where $\cup_{i,j} A_i \cap B_j = X$.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}
		Let $f, g$ be \ul{non-negative simple} functions with $f \geq g$ everywhere. Then $\int f\ d\mu \geq \int g\ d\mu$.
		\begin{proof}
			Let $f$ and $g$ be simple functions represented by $\{(A_i, a_i)\}_{i=1}^n$ and $\{(B_j, b_j)\}_{j=1}^m$.
			
			Claim: $a_i \mu(A_i \cap B_j) \geq b_j \mu(A_i \cap B_j)$ for every $(i, j)$. If $A_i \cap B_j \neq \varnothing$, then taking some $x \in A_i \cap B_j$ implies $a_i \geq b_j$. If $A_i \cap B_j = \varnothing$, the equality holds trivially.
			
			Note that $\int f$ and $\int g$ can be written as $\sum_{i, j} a_i \mu(A_i \cap B_j)$ and $\sum_{i, j} b_j \mu(A_i \cap B_j)$ respectively, therefore $\int f \geq \int g$ by the previous claim.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}[Approximation using Simple Functions]
		Let $f: X \to [0, \infty]$ be a \ul{measurable} function. Then there exists an \ul{increasing} sequence of \ul{non-negative simple} functions $f_n$ such that $f_n \leq f_{n+1}$ and 
		\begin{align}
			\lim_{n \to \infty} f_n(x) = f(x)	
		\end{align}
		for all $x$.
		\begin{proof}
			For each $n$ and $1 \leq k \leq n 2^n$, let
			\begin{align}
				A_{n, k}=\left\{x \in X: \frac{k-1}{2^{n}} \leq f(x)<\frac{k}{2^{n}}\right\}
			\end{align}
			Define
			\begin{align}
				f_n(x) = \begin{cases}
					\frac{k-1}{2^n} &\tx{ if } x \in A_{n, k} \\
					n &\tx{ otherwise}
				\end{cases}
			\end{align}
			That is, for a $x \in X$, if $\frac{k-1}{2^{n}} \leq f(x)<\frac{k}{2^{n}}$ for some $k$, we take $f_n(x) = \frac{k-1}{2^{n}}$; if $f(x) \geq n$, we define $f_n(x) = n$. Clearly, each $f_n$ is a simple function.
			
			Claim 1: $f_n \leq f_{n+1}$. Easy to verify.
			
			Claim 2: $\lim_{n \to \infty} f_n(x) = f(x)$. Let $x \in X$, (i) if $f(x) = \infty$, then $f_n(x) = n$ for all $n \in \N$ and $\lim_{n \to \infty} f_n(x) = \infty = f(x)$.
			
			(ii) if $f(x) < \infty$, then $\exists n_0$ such that $f(x) < n_0$. For every $n \geq n_0$, $x \in A_{n,k}$ for some $k$ such that $f_n(x) = \frac{k-1}{2^n}$ and $\frac{k-1}{2^n} \leq f(x) < \frac{k}{2^n}$. Therefore, for all $n \geq n_0$, $|f_n(x) - f(x)| < \frac{1}{2^n}$, which implies $\lim_{n \to \infty} f_n(x) = f(x)$.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}[Monotone Convergence 1: $\mathds{S}_+ \uparrow \mathds{S}_+$]
		Let $f_n$ be a sequence of \ul{non-negative simple} functions that \ul{increase} to another \ul{non-negative simple} function $f$ at each point, then 
		\begin{align}
			\int f\ d\mu = \lim_{n\to\infty} \int f_n\ d\mu	
		\end{align}
		\begin{proof}
			By monotonicity, $f_n \leq f$ for all $n$ and $\int f\ d\mu \geq \lim \int f_n\ d\mu$.
			
			Fix $0 < \varepsilon < 1$ and define $g = (1-\varepsilon) f$. Suppose $f$ is represented by $(A_i, a_i)$. Then for every $n, i$, define
			\begin{align}
				A_{n, i}=\left\{x \in A_{i}: f_{n}(x) \geq (1-\varepsilon) a_{i}\right\}
			\end{align}
			Define
			\begin{align}
				g_n(x) = \begin{cases}
 					(1-\varepsilon) a_i &\tx{ if } x \in A_{n_i} \\
 					0 &\tx{ otherwise}	
				\end{cases}
			\end{align}
			In order to show $\int f\ d\mu \leq \lim \int f_n\ d\mu$, we are constructing this $g_n$ satisfying 
			\begin{align}
				(1-\varepsilon) \int f\ d\mu \leq \lim \int g_n\ d\mu \leq \lim \int f_n\ d\mu \leq \int f\ d\mu
			\end{align}
			where the last equality has been shown above. The equality can then be shown by taking $\varepsilon \to 0$ and using Squeeze theorem. Note that $(1-\varepsilon) \int f\ d\mu \centernot \leq \int g_n\ d\mu$, only the limit does.
			
			By construction, $g_n \leq f_n$ and $\int g_n\ d\mu \leq \int f_n\ d\mu$ as a result.
			\begin{align}
				\lim_n \int f_n\ d\mu &\geq \lim_n g_n\ d\mu \\
				&= \lim_n \sum_{i=1}^K (1-\varepsilon) a_i \mu(A_{n,i}) \\
				&= \sum_{i=1}^K (1-\varepsilon) a_i \lim_n \mu(A_{n,i}) \\
				&= \sum_{i=1}^K (1-\varepsilon) a_i \mu(A_i) \tx{ Since for all $i$, $A_{n,i} \uparrow A_i$ as $n \to \infty$.}\\
				&= (1-\varepsilon) \int f\ d\mu
			\end{align}
			Taking $\varepsilon \to 0$ completes the proof.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}[Monotone Convergence 2: $\mathds{S}_+ \uparrow$ Measurable]
		Let $f: X \to [0, \infty]$ be a \ul{measurable} function. Let $f_n$ be a sequence of \ul{non-negative simple} functions such that $f_n \uparrow f$ point-wise. Then
		\begin{align}
			\int f\ d\mu = \lim_{n \to \infty} \int f_n\ d\mu
		\end{align}
		
		\begin{proof}
			The proof follows the previous proposition and the definition of $\int f\ d\mu$.
			Since $f_n \uparrow f$, $f_n \leq f$ and $\int f_n \leq \int f$ for all $n$. $\int f_n$ is a bounded monotone sequence, therefore $\lim \int f_n$ exists and $\leq \int f$.
			
			To show the other equality, it suffices to prove $\lim \int f_n \geq \int g$ for any non-negative simple functions $g \leq f$.
			
			Define $g_n = \min \{g, f_n\}$, easy to show that $g_n(x) \leq g_{n+1}(x)$.
			\begin{align}
				\lim_{n\to\infty} g_n(x) &= \lim_{n\to\infty} \min \{g, f_n\} \\
				&= \min\{g(x), f(x)\} \\
				&= g(x)
			\end{align}
			since $f_n \uparrow f$ and $g \leq f$.
			
			By the previous proposition, $\int g\ d\mu = \lim \int g_n\ d\mu$ since $g_n$ and $g$ are non-negative simple functions. Since $g_n \leq f_n$ everywhere, so $\int g_n\ d\mu \leq \int f_n\ d\mu$.
			Taking limit on both sides implies $\int g \leq \lim \int f_n$.
		\end{proof}
	\end{proposition}
	
	\begin{proposition}[Vector Space Properties for Non-negative Integrable Functions]
		Let $f, g: X \in [0, \infty]$ be \ul{integrable} (of course, \ul{measurable} as well) functions and $\alpha \geq 0$. Then
		\begin{enumerate}
			\item $\int f+g\ d\mu = \int f\ d\mu + \int g\ d\mu$.
			\item $\int \alpha f\ d\mu = \alpha \int f\ d\mu$.
			\item If $f \geq g$ everywhere, then $\int f\ d\mu \geq \int g\ d\mu$.
		\end{enumerate}
		\begin{proof}
			We know that there exists sequences of non-negative simple functions $f_n$ and $g_n$ such that $f_n \uparrow f$ and $g_n \uparrow g$. Note that $f_n + g_n$ is a sequence of simple functions increases to $f + g$. Therefore,
			\begin{align}
				\int (f + g) d \mu &= \lim_{n \to \infty} \int (f_n + g_n)\ d\mu \\
				&= \lim_{n \to \infty} \left(\int f_n\ d\mu + \int g_n\ d\mu \right) \\
				&= \lim_{n \to \infty} \int f_n\ d\mu + \lim_{n \to \infty}  \int g_n\ d\mu \\
				&= \int f\ d\mu + \int g\ d\mu
			\end{align}
			Similarly, taking $\alpha f_n \uparrow \alpha f$ leads to the second result.
			
			Finally, if $f \geq g$ everywhere, then 
			\begin{align}
				\{h \in \mathds{S}_+ \tx{ and } h \leq g\} \subseteq \{h \in \mathds{S}_+ \tx{ and } h \leq f\}
			\end{align}
			Therefore, the supremum of integrals of functions from a larger collection is larger.
		\end{proof}
	\end{proposition}
	
	\subsection{Linearity of Lebesgue Integral for Arbitrary Integrable Functions}
	\begin{theorem}[Vector Space Property of Integral Functions]
		Let $(X, \mc{A}, \mu)$ be a measure space, let $f, g: X \to \R^*$ be integrable functions, let $\alpha \in \R$. Then, $f+g$ and $\alpha f$ are integrable, and
		\begin{align}
			\int f + g d\mu &= \int f d\mu + \int g d\mu \\
			\int \alpha f d\mu &= \alpha \int f d\mu
		\end{align}
		\begin{proof}
			It's easy to check that $(f+g)^+ \leq f^+ + g^+$ and $(f+g)^- \leq f^- + g^-$. By monotonicity, $\int (f+g)^+ d\mu, \int (f+g)^- d\mu < \infty$. Therefore, $f+g$ is integrable.
			
			Moreover, $f+g = f^+ - f^- + g^+ - g^- \iff f + g + f^- + g^- = f^+ + g^+$. We can apply the linearity of non-negative integrable functions to derive the result.
			
			When $\alpha \geq 0$, $(\alpha f)^+ = \alpha f^+$ and $(\alpha f)^- = \alpha f^-$. The proof for cases with $\alpha < 0$ is similar.
		\end{proof}
	\end{theorem}
	
	\begin{corollary}
		Let $f, g$ be integrable functions such that $f \geq g$, then $\int f\ d\mu \geq \int g\ d\mu$.
		\begin{proof}
			Let $h = f - g = f + (-1)g \geq 0$, which is integrable by the previous theorem. And $\int h\ d\mu \geq 0$ since its the supremum of integrals for simple functions less than $h$, which includes the zero function (has zero integral).
		\end{proof}
	\end{corollary}
	
	\begin{lemma}
		A function $f$ is integrable \ul{if and only if} $|f|$ is integrable.
		\begin{proof}
			Note that $|f| = f^+ + f^-$, and $\int f^+ + f^-\ d\mu < \infty$ by the integrability of $f$. Therefore, $|f|$ is integrable.
			
			Moreover, $|f|^+ = f^+ + f^-$, therefore, the integrability of $|f|$ implies both $\int f^+\ d\mu$ and $\int f^-\ d\mu$ are finite.
		\end{proof}
	\end{lemma}
	
	\begin{proposition}
		All integrable function $f$ satisfies the triangle inequality
		\begin{align}
			\abs{\int f\ d\mu} \leq \int \abs{f}\ d\mu
		\end{align}
		
		\begin{proof}
			\begin{align}
				\abs{\int f\ d\mu} &= \abs{\int f^+ - f^-\ d\mu}\\
				&= \abs{\int f^+\ d\mu - \int f^-\ d\mu}\\
				&\leq \abs{\int f^+\ d\mu} + \abs{\int f^-\ d\mu} \\
				&= \int f^+\ d\mu + \int f^-\ d\mu \\
				&= \int \abs{f}\ d\mu
			\end{align}
		\end{proof}
	\end{proposition}
	
	\section{Limit Theorems (i.e., when we can exchange limits and integrals)}
	\begin{theorem}[Monotone Convergence Theorem]
		Let $(X, \mc{A}, \mu)$ be a measure space, let $f_n: X \to [0, \infty]$ be a \ul{non-decreasing} sequence of measurable functions converge to $f$. Then,
		\begin{align}
			\int f\ d\mu = \lim_{n\to\infty} \int f_n\ d\mu
		\end{align}
		\begin{proof}
			$f$ measurable since $f = \lim_n f_n = \liminf_n f_n$. Moreover, $\int f_n\ d\mu$ is a non-decreasing sequence to the limit $\int f\ d\mu$, therefore $\int f\ d\mu \geq \lim_n \int f_n\ d\mu$.

			For each $n \in \N$, there exists a non-decreasing sequence of non-negative simple functions $g_{n,k}$ converges to $f_n$. Define
			\begin{align}
				h_n = \max\{g_{1,n}, g_{2,n}, \dots, g_{n,n}\}
			\end{align}
			Note that $h_n$ is a non-decreasing sequence since
			\begin{align}
				h_{n+1} &= \max\{g_{1,n+1}, g_{2,n+1}, \dots, g_{n+1,n+1}\} \\
				&\geq \max\{g_{1,n+1}, g_{2,n+1}, \dots, g_{n,n+1}\} \\
				&\geq \max\{g_{1,n}, g_{2,n}, \dots, g_{n,n}\} = h_n
			\end{align}
			Moreover, for any $m \in \N$, for any $n \geq m$,
			\begin{align}
				h_n(x) &=  \max\{g_{1,n}, g_{2,n}, \dots, g_{n,n}\}
				\geq g_{m,n}
			\end{align}
			Therefore, by taking the limit $n \to \infty$,
			\begin{align}
				\lim_{n \to \infty} h_n(x) \geq \lim_{n \to \infty} g_{m, n} = f_m
			\end{align}
			Taking limit $m \to \infty$ on both sides
			\begin{align}
				\lim_n h_n(x) = \lim_m \lim_n h_n(x) \geq \lim_m f_m = f \\
				\implies \int \lim_n h_n(x)\ d\mu \geq \int f\ d\mu
			\end{align}
			Note that, by construction,
			\begin{align}
				h_n =  \max\{g_{1,n}, g_{2,n}, \dots, g_{n,n}\} \leq \max\{f_1, \dots, f_n\} = f_n
			\end{align}
			Therefore,
			\begin{align}
				\int \lim_{n\to\infty} f_n(x)\ d\mu \geq \int f\ d\mu
			\end{align}
		\end{proof}
	\end{theorem}
	
	\begin{corollary}
		Let $(f_n)$ be a sequence (not necessarily increasing) non-negative measurable functions, then
		\begin{align}
			\int \sum_{n=1}^\infty f_n\ d\mu = \sum_{n=1}^\infty \int f_n\ d\mu
		\end{align}
	\end{corollary}
	
	\begin{theorem}[Fatou's Lemma]
		Let $f_n$ be a sequence of \ul{non-negative} measurable functions, then
		\begin{align}
			\int \liminf_{n\to\infty} f_n\ d\mu \leq \liminf_{n\to\infty} \int f_n\ d\mu
		\end{align}
		\begin{proof}
			Define $g_n = \inf_{k \geq n} f_k$, then $g_n$ is an increasing sequence of non-negative functions. By construction, $\int g_n\ d\mu \leq \inf_{k \geq n}\int f_k\ d\mu$.
			By MCT,
			\begin{align}
				\int \liminf_{n \to \infty} f\ d\mu &= \int \lim_{n\to\infty} g_n\ d\mu \\
				&= \lim_{n\to\infty} \int g_n\ d\mu \\
				&\leq \lim_{n\to\infty} \inf_{k \geq n}\int f_k\ d\mu \\
				&= \liminf_{n\to\infty} \int f_n\ d\mu
			\end{align}
		\end{proof}
	\end{theorem}
	
	\begin{theorem}[Lebesgue's Dominated Convergence Theorem]
		Let $(X, \mc{A}, \mu)$ be a measure space, let $f$ and $f_n$ be $\R^*$-valued measurable functions on $X$ such that $f_n \to f$ point-wise. If there exists a non-negative \ul{integrable} function $g$ such that $|f_n| \leq g$ for all $n$, then, all $f$ and $f_n$ are integrable, moreover,
		\begin{align}
			\int f\ d\mu = \lim_{n\to\infty} \int f_n\ d\mu
		\end{align}
		\begin{proof}
			Since $|f_n| \leq g$, all $f_n$ are integrable. The limit $f$ also satisfies $|f| \leq g$ and is integrable.
			
			\emph{For now, assume $f_n$ are $\R$-valued instead of $\R^*$-valued.}
			
			Note that $f + g = \lim_{n\to\infty} f_n + g$ is non-negative (because of the dominance) and integrable, by Fatou's lemma
			\begin{align}
				\int f + g\ d\mu &= \int \liminf f + g\ d\mu \leq \liminf \int f_n + g\ d\mu \\
				&= \liminf \int f_n\ d\mu + \int g\ d\mu \\
				\implies \int f\ d\mu &\leq \liminf \int f_n\ d\mu
			\end{align}
			Similarly, $g - f = \lim_{n\to\infty} g - f_n$ is non-negative and integrable as well, by Fatou's lemma
			\begin{align}
				\int g - f\ d\mu &= \int \liminf g - f_n\ d\mu \leq \liminf \int g - f_n\ d\mu \\
				\implies - \int f\ d\mu &\leq - \liminf \int f_n\ d\mu \\
				\implies \int f\ d\mu &\geq \limsup \int f_n \ d\mu
			\end{align}
			Also, $\liminf \int f_n\ d\mu \leq \limsup \int f_n\ d\mu$, therefore,
			\begin{align}
				\liminf \int f_n\ d\mu \geq \int f\ d\mu &\geq \limsup \int f_n \ d\mu \geq \liminf \int f_n\ d\mu  \\
				\implies \int f\ d\mu &= \lim \int f_n\ d\mu
			\end{align}
		\end{proof}
	\end{theorem}
	
	\begin{proposition}[A Stronger Result]
		Given assumptions of the dominated convergence theorem, $f_n$ $L^1$-converges to $f$.
		\begin{align}
			\lim_{n\to\infty} \int \abs{f_n - f}\ d\mu = 0
		\end{align}
		\begin{proof}
			Note that $\abs{f_n - f} \to 0$ point-wise, and $\abs{f_n - f} \leq 2 g$. The dominated convergence theorem suggests $\lim_{n\to\infty} \int \abs{f_n - f}\ d\mu = \int 0\ d\mu = 0$.
		\end{proof}
	\end{proposition}
	
	\subsection{The Notion of Almost Everywhere}
	\begin{definition}
		Let $(X, \mc{A}, \mu)$ be a measure space, a set $N \subseteq X$ (not necessarily measurable) is called "\textbf{negligible} w.r.t. $\mu$" if $N \subseteq A$ for some $A \in \mc{A}$ with $\mu(A)=0$.
		
		A property is said to hold \textbf{almost everywhere} w.r.t. $\mu$ (denoted as $\mu$-a.e.) if the set on which this property fails is negligible.
	\end{definition}
	
	\begin{proposition}
		Let $f: X \to [0, \infty]$ be an integrable function, then $f$ is finite $\mu$-a.e.
		\begin{proof}
			Let $A := f^{-1}(\infty)$, define $h_n(x) := n \id{x \in A}$. Clearly, $h_n$ is a simple function $\leq f$ for every $n$, by monotonicity, $\int f\ d\mu \leq \int h_n\ d\mu = n \mu(A)$. Taking $n\to\infty$ leads to a contradiction.
		\end{proof}
	\end{proposition}
	
	\begin{corollary}
		If $f: X \to \R^*$ is integrable w.r.t. $\mu$, then $|f| < \infty$ $\mu$-a.e.
		\begin{proof}
			$f$ is integrable implies $\int f^+\ d\mu, \int f^-\ d\mu < \infty$. Then,
			by the previous proposition, $f^+ < \infty$ except for a negligible set $A$, and $f^- < \infty$ expect for a negligible set $B$. Therefore, $|f| = \infty$ on set $A \cup B$, which is negligible as well.
		\end{proof}
	\end{corollary}
\end{document}




























